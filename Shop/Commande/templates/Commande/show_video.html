{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8 text-center">
            <!-- Titre du produit -->
            <h2 class="fw-bold text-primary">{{ product.nom }}</h2>
            <p class="text-muted">{{ product.description }}</p>

            {% with product.imageproduit_set.all as images %}
                {% if images|length == 0 %}
                    <p>Aucune image ou vidéo disponible pour ce produit.</p>
                {% else %}
                    {% with images|dictsort:"id" as sorted_images %}
                        {% with sorted_images|first as first_image %}
                            {% if first_image.video_desc %}
                                <!-- Vidéo disponible -->
                                <div class="video-container mt-4 shadow-lg rounded">
                                    <video id="videoProduit" class="w-100 rounded" autoplay muted controls>
                                        <source src="{{ first_image.video_desc.url }}" type="video/mp4">
                                        Votre navigateur ne supporte pas la vidéo.
                                    </video>
                                </div>
                            {% else %}
                                <!-- Aucune vidéo, affichage des images -->
                                <div class="row mt-4">
                                    {% for image in images %}
                                        <div class="col-md-6 mb-3">
                                            <img src="{{ image.image.url }}" class="img-fluid rounded shadow" alt="Image du produit">
                                        </div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        {% endwith %}
                    {% endwith %}

                    <!-- Bouton commander toujours actif -->
                    <a href="{% url 'commande' product.slug %}" data-produit-slug="{{ product.slug }}">
                        <button class="btn btn-primary btn-lg mt-4 px-4 py-2" id="btnCommander">
                            <i class="fas fa-shopping-cart"></i> Commander
                        </button>
                    </a>
                {% endif %}
            {% endwith %}
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    let video = document.getElementById("videoProduit");

    if(video){
        // Lancer la vidéo automatiquement
        video.play().catch(function(err){
            console.log("Autoplay a échoué :", err);
        });
    }
});
</script>

<!-- Styles CSS -->
<style>
    .video-container {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%; /* 16:9 Aspect ratio */
        height: 0;
        overflow: hidden;
        background-color: #000;
        border-radius: 12px;
        box-shadow: 0px 6px 15px rgba(0, 0, 0, 0.2);
    }
    .video-container video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: contain;
        border-radius: 12px;
    }
    #btnCommander {
        transition: background-color 0.3s ease, transform 0.2s ease;
    }
    #btnCommander:hover {
        background-color: #28a745;
        transform: scale(1.05);
    }
    @media (max-width: 768px) {
        .video-container {
            padding-bottom: 56.25%;
        }
    }
</style>
{% endblock %}
